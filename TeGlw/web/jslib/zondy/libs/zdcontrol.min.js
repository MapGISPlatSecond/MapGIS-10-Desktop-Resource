Zondy.Control=OpenLayers.Class(Zondy,{}),Zondy.Marker=OpenLayers.Class(Zondy,{}),Zondy.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:9,zoomStopHeight:11,slider:null,sliderEvents:null,zoomBarDiv:null,divEvents:null,zoomWorldIcon:!0,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this.div.removeChild(this.slider),this.slider=null,this.sliderEvents.destroy(),this.sliderEvents=null,this.div.removeChild(this.zoombarDiv),this.zoomBarDiv=null,this.divEvents.destroy(),this.divEvents=null,this.map.events.un({zoomend:this.moveZoomBar,changebaselayer:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){null!=this.div&&(this.div.innerHTML=""),this.draw()},draw:function(a){var b,c,d,e,f;return OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position.clone(),a=new OpenLayers.Pixel(6,6),this.buttons=[],b=new OpenLayers.Size(19,16),c=new OpenLayers.Size(57,21),d=new OpenLayers.Pixel(a.x+b.w,a.y),e=new OpenLayers.Pixel(a.x,a.y-5),f=b.w,this.zoomWorldIcon||(d=new OpenLayers.Pixel(a.x+b.w/2,a.y),c=new OpenLayers.Size(36,18),e=new OpenLayers.Pixel(a.x,a.y)),this._addButton("panup","zongdy_up.png",e,c),a.y=d.y+b.h,this._addButton("panleft","zongdy_left.png",a,b),this.zoomWorldIcon&&(this._addButton("zoomworld","zongdy_refresh.png",a.add(b.w,0),b),f*=2),this._addButton("panright","zongdy_right.png",a.add(f,0),b),this._addButton("pandown","zongdy_down.png",e.add(0,2*b.h+5),c),this._addButton("zoomin","zongdy_plus.png",d.add(0,3*b.h+5),b),d=this._addZoomBar(d.add(0,4*b.h+5)),this._addButton("zoomout","zongdy_minus.png",d,b),this.div},_addZoomBar:function(a){var f,g,b=OpenLayers.Util.getImagesLocation(),c=this.id+"_"+this.map.id,d=this.map.getNumZoomLevels()-1-this.map.getZoom(),e=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,d*this.zoomStopHeight),new OpenLayers.Size(20,9),b+"slider.png","absolute");return e.style.left="25px",this.slider=e,this.sliderEvents=new OpenLayers.Events(this,e,null,!0,{includeXY:!0}),this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick}),f=new OpenLayers.Size,f.h=this.zoomStopHeight*this.map.getNumZoomLevels(),f.w=this.zoomStopWidth,g=null,OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,g=OpenLayers.Util.createAlphaImageDiv(c,a,new OpenLayers.Size(f.w,this.zoomStopHeight),b+"zongdy_zoombar.png","absolute",null,"crop"),g.style.height=f.h+"px"):g=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,f,b+"zongdy_zoombar.png"),g.style.left="30px",this.zoombarDiv=g,this.divEvents=new OpenLayers.Events(this,g,null,!0,{includeXY:!0}),this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick}),this.div.appendChild(g),this.startTop=parseInt(g.style.top),this.div.appendChild(e),this.map.events.register("zoomend",this,this.moveZoomBar),a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels()),this.div.style.left="8px",this.div.style.top="8px",a},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){var b,c,d,e;OpenLayers.Event.isLeftClick(a)&&(b=a.xy.y,c=OpenLayers.Util.pagePosition(a.object)[1],d=(b-c)/this.zoomStopHeight,this.map.fractionalZoom||(d=Math.floor(d)),e=this.map.getNumZoomLevels()-1-d,e=Math.min(Math.max(e,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(e),OpenLayers.Event.stop(a))},zoomBarDown:function(a){OpenLayers.Event.isLeftClick(a)&&(this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a))},zoomBarDrag:function(a){var b,c,d;null!=this.mouseDragStart&&(b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv),a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2&&(d=parseInt(this.slider.style.top)-b,this.slider.style.top=d+"px"),this.mouseDragStart=a.xy.clone(),OpenLayers.Event.stop(a))},zoomBarUp:function(a){var b,c;OpenLayers.Event.isLeftClick(a)&&this.zoomStart&&(this.div.style.cursor="",this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this}),b=this.zoomStart.y-a.xy.y,c=this.map.zoom,this.map.fractionalZoom?(c+=b/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)):c+=Math.round(b/this.zoomStopHeight),this.map.zoomTo(c),this.moveZoomBar(),this.mouseDragStart=null,OpenLayers.Event.stop(a))},moveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"Zondy.Control.PanZoomBar"}),Zondy.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:1,showMinorMeasures:!1,singleLine:!1,align:"left",div:null,scaleText:"比例尺 1:",thousandsSeparator:"",measurementProperties:{english:{units:["英里","英尺","英寸"],inches:[63360,12,1]},metric:{units:["千米","米","厘米"],inches:[39370.07874,39.370079,.393701]}},limitedStyle:!1,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:7,width:2,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.limitedStyle,this.element=document.createElement("div"),this.element.style.position="relative",this.element.className=this.displayClass+"Wrapper",this.labelContainer=document.createElement("div"),this.labelContainer.className=this.displayClass+"Units",this.labelContainer.style.position="absolute",this.graphicsContainer=document.createElement("div"),this.graphicsContainer.style.position="absolute",this.graphicsContainer.className=this.displayClass+"Graphics",this.numbersContainer=document.createElement("div"),this.numbersContainer.style.position="absolute",this.numbersContainer.className=this.displayClass+"Numbers",this.element.appendChild(this.graphicsContainer),this.element.appendChild(this.labelContainer),this.element.appendChild(this.numbersContainer)},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend),this.div.innerHTML="",OpenLayers.Control.prototype.destroy.apply(this)},draw:function(){var a,b,c,d;for(OpenLayers.Control.prototype.draw.apply(this,arguments),this.dxMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2,this.dxMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2,this.dxBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2,this.dxBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2,this.dxNumbersBox=this.styleValue("NumbersBox","width")/2,a=["Bar","BarAlt","MarkerMajor","MarkerMinor"],this.singleLine?a.push("LabelBoxSingleLine"):a.push("NumbersBox","LabelBox"),b=0,c=0;c<a.length;++c)d=a[c],b=Math.max(b,this.styleValue(d,"top")+this.styleValue(d,"height"));return this.element.style.height=b+"px",this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left"),this.div.appendChild(this.element),this.map.events.register("moveend",this,this.onMoveend),this.update(),this.div},onMoveend:function(){this.update()},update:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;if(null!=this.map.baseLayer&&this.map.getScale()){for(this.scale=void 0!=a?a:this.map.getScale(),this.element.title=this.scaleText+OpenLayers.Number.format(this.scale),this.element.style.width=this.maxWidth+"px",b=this.getComp(),this.setSubProps(b),this.labelContainer.innerHTML="",this.graphicsContainer.innerHTML="",this.numbersContainer.innerHTML="",c=this.divisions*this.subdivisions,d={left:0+(this.singleLine?0:this.dxNumbersBox),center:this.maxWidth/2-c*this.subProps.pixels/2-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-c*this.subProps.pixels-(this.singleLine?this.xOffsetSingleLine:this.dxNumbersBox)},j=0;j<this.divisions;++j)for(e=j*this.subdivisions*this.subProps.pixels+d[this.align],this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",e-this.dxMarkerMajor)),this.singleLine||(f=0==j?0:OpenLayers.Number.format(j*this.subdivisions*this.subProps.length,this.subProps.dec,this.thousandsSeparator),this.numbersContainer.appendChild(this.createElement("NumbersBox",f,e-this.dxNumbersBox))),k=0;k<this.subdivisions;++k)0==k%2?(h="Bar",i=e-this.dxBar):(h="BarAlt",i=e-this.dxBarAlt),this.graphicsContainer.appendChild(this.createElement(h," ",i,this.subProps.pixels)),k<this.subdivisions-1&&(g=j*this.subdivisions+k+1,e=g*this.subProps.pixels+d[this.align],this.graphicsContainer.appendChild(this.createElement("MarkerMinor"," ",e-this.dxMarkerMinor)),this.showMinorMeasures&&!this.singleLine&&(f=g*this.subProps.length,this.numbersContainer.appendChild(this.createElement("NumbersBox",f,e-this.dxNumbersBox))));e=c*this.subProps.pixels,e+=d[this.align],this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",e-this.dxMarkerMajor)),f=OpenLayers.Number.format(c*this.subProps.length,this.subProps.dec,this.thousandsSeparator),this.singleLine||this.numbersContainer.appendChild(this.createElement("NumbersBox",f,e-this.dxNumbersBox)),l=document.createElement("div"),l.style.position="absolute",this.singleLine?(m=f,l.className=this.displayClass+"LabelBoxSingleLine",l.style.left=Math.round(e+this.styleValue("LabelBoxSingleLine","left"))+"px"):(m="",l.className=this.displayClass+"LabelBox",l.style.textAlign="center",l.style.width=Math.round(c*this.subProps.pixels)+"px",l.style.left=Math.round(d[this.align])+"px",l.style.overflow="hidden"),m+=" "+this.subProps.units,l.appendChild(document.createTextNode(m)),this.labelContainer.appendChild(l)}},createElement:function(a,b,c,d){var e=document.createElement("div");return e.className=this.displayClass+a,OpenLayers.Util.extend(e.style,{position:"absolute",textAlign:"center",overflow:"hidden",left:Math.round(c)+"px"}),e.appendChild(document.createTextNode(b)),d&&(e.style.width=Math.round(d)+"px"),e},getComp:function(){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,a=this.measurementProperties[this.displaySystem],b=a.units.length,c=new Array(b),d=this.divisions*this.subdivisions;for(e=0;b>e;++e)for(c[e]={},f=OpenLayers.DOTS_PER_INCH*a.inches[e]/this.scale,g=(this.minWidth-this.dxNumbersBox)/f/d,h=(this.maxWidth-this.dxNumbersBox)/f/d,i=0;d>i;++i){for(j=g*(i+1),k=h*(i+1),l=this.getHandsomeNumber(j,k),m={value:l.value/(i+1),score:0,tie:0,dec:0,displayed:0},n=0;d>n;++n)o=l.value*(n+1)/(i+1),p=this.getHandsomeNumber(o,o),q=0==(n+1)%this.subdivisions,r=n+1==d,this.singleLine&&r||!this.singleLine&&(q||this.showMinorMeasures)?(m.score+=p.score,m.tie+=p.tie,m.dec=Math.max(m.dec,p.dec),m.displayed+=1):(m.score+=p.score/this.subdivisions,m.tie+=p.tie/this.subdivisions);m.score*=(e+1)*m.tie/m.displayed,c[e][i]=m}return c},setSubProps:function(a){var e,f,g,h,b=this.measurementProperties[this.displaySystem],c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY;for(e=0;e<a.length;++e){f=OpenLayers.DOTS_PER_INCH*b.inches[e]/this.scale;for(g in a[e])h=a[e][g],(h.score<c||h.score==c&&h.tie<d)&&(this.subProps={length:h.value,pixels:f*h.value,units:b.units[e],dec:h.dec},c=h.score,d=h.tie)}},styleValue:function(a,b){var d,e,f,h,i,c=0;if(this.limitedStyle)c=this.appliedStyles[a][b];else{a="."+this.displayClass+a;a:for(d=document.styleSheets.length-1;d>=0;--d)if(e=document.styleSheets[d],!e.disabled){try{if("undefined"==typeof e.cssRules){if("undefined"==typeof e.rules)continue;f=e.rules}else f=e.cssRules}catch(g){continue}for(h=0;h<f.length;++h)if(i=f[h],i.selectorText&&i.selectorText.toLowerCase()==a.toLowerCase()&&""!=i.style[b]){c=parseInt(i.style[b]);break a}}}return c?c:0},getHandsomeNumber:function(a,b,c){var d,e,f,g,h,i,j,k,l,m;for(c=null==c?10:c,d={value:a,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3},l=0;3>l;++l)for(e=Math.pow(2,-1*l),f=Math.floor(Math.log(b/e)/Math.LN10),m=f;m>f-c+1;--m)g=Math.max(l-m,0),h=e*Math.pow(10,m),h*Math.floor(b/h)>=a&&(i=0==a%h?a/h:Math.floor(a/h)+1,j=i+2*l,k=0>m?Math.abs(m)+1:m,(j<d.score||j==d.score&&k<d.tie)&&(d.value=parseFloat((h*i).toFixed(g)),d.score=j,d.tie=k,d.dec=g));return d},CLASS_NAME:"Zondy.Control.ScaleBar"}),Zondy.Control.LegendBar=OpenLayers.Class(OpenLayers.Control,{element:null,legendName:"图例",left:null,top:null,LegendMarks:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),a&&(this.legendName=a),this.LegendMarks=[],this.element=document.createElement("div"),this.element.style.position="relative"},destroy:function(){this.div.innerHTML="",OpenLayers.Control.prototype.destroy.apply(this)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.left||this.top?(this.div.style.left=this.left+"px",this.div.style.top=this.top+"px"):(this.div.style.right="10px",this.div.style.bottom="10px"),this.div.style.border="double blue 4px",this.div.style.backgroundColor="#E2ECFA";var a=document.createElement("div");return a.style.textAlign="center",a.style.fontSize="13",a.appendChild(document.createTextNode(this.legendName)),this.div.appendChild(a),this.div.appendChild(this.element),this.div},addLegendMark:function(a){this.element.appendChild(a.markContainerDiv),this.LegendMarks.push(a),a.draw()},removeLegendMark:function(a){var b,c,d;for(this.element.removeChild(a.markContainerDiv),b=0,c=this.LegendMarks.length;c>b;b++)if(d=this.LegendMarks[b],d==a){this.LegendMarks.splice(b,1);break}a.legendBar=null,a.destroy()},CLASS_NAME:"Zondy.Control.LegendBar"}),Zondy.Control.LegendMark=OpenLayers.Class({markContainerDiv:null,markName:"名称1",markPicUrl:"",left:2,top:2,legendBar:null,initialize:function(a,b,c,d){b&&(this.markName=b),this.markPicUrl=a,c&&d&&(this.left=c,this.top=d),this.markContainerDiv=document.createElement("div"),this.markContainerDiv.style.position="relative",this.markContainerDiv.style.left=this.left+"px",this.markContainerDiv.style.top=this.top+"px"},destroy:function(){this.markContainerDiv.innerHTML="",this.markContainerDiv=null},clone:function(a){return null==a&&(a=new Zondy.Control.LegendMark(this.markPicUrl,this.markName,this.left,this.top)),a.legendBar=null,a},draw:function(){var c,d,e,f,a=document.createElement("div"),b=document.createElement("div");return a.appendChild(OpenLayers.Util.createImage(null,null,OpenLayers.Size(10,10),this.markPicUrl,null,null,null,null)),b.style.fontSize="10",b.appendChild(document.createTextNode(this.markName)),c=document.createElement("table"),c.border="0px",d=c.insertRow(0),e=d.insertCell(0),e.appendChild(a),f=d.insertCell(1),f.appendChild(b),this.markContainerDiv.appendChild(c),this.display(!0),this.markContainerDiv},setLegendBar:function(a){this.legendBar=a},display:function(a){this.markContainerDiv.style.display=a?"":"none"},CLASS_NAME:"Zondy.Control.LegendMark"}),Zondy.Control.Magnifier=OpenLayers.Class(OpenLayers.Control,{mapDiv:null,mmap:null,draggable:!0,size:new OpenLayers.Size(160,160),zoomable:!0,delta:1,mapOptions:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.mapOptions=a},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),OpenLayers.Util.getImagesLocation(),this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px",this.div.style.top="5px",this.div.style.right="5px",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="absolute",this.mapDiv.style.zIndex=1,this.mapDiv.style.cursor="crosshair",this.div.appendChild(this.mapDiv),this.mmap=this.mapOptions.maxExtent&&this.mapOptions.maxResolution?new OpenLayers.Map(this.mapDiv,OpenLayers.Util.applyDefaults({maxExtent:this.mapOptions.maxExtent,maxResolution:this.mapOptions.maxResolution,controls:[],layers:[this.map.baseLayer.clone()]},this.map.initialOptions)):new OpenLayers.Map(this.mapDiv,OpenLayers.Util.applyDefaults({controls:[],layers:[this.map.baseLayer.clone()]},this.map.initialOptions)),OpenLayers.Event.observe(this.mapDiv,"mousemove",OpenLayers.Function.bindAsEventListener(this.drag,this)),this.handlers=this.handlers||{},this.zoomable&&(this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.zoom,down:this.zoom}),this.handlers.wheel.setMap(this.mmap),this.handlers.wheel.activate()),this.map.events&&this.map.events.on({move:this.update,changebaselayer:this.changelayer,scope:this}),this.div},zoom:function(a,b){this.delta=Math.max(this.delta+b,0),this.mmap.zoomTo(this.map.getZoom()+this.delta)},drag:function(a){if(!this.map.div.scrolls){var b=OpenLayers.Util.getViewportElement();this.map.div.scrolls=[b.scrollLeft,b.scrollTop]}this.map.div.lefttop||(this.map.div.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.map.div.offsets||(this.map.div.offsets=OpenLayers.Util.pagePosition(this.map.div)),this.div.style.left=a.clientX+this.map.div.scrolls[0]-this.map.div.offsets[0]-this.map.div.lefttop[0]-this.size.w/2+"px",this.div.style.top=a.clientY+this.map.div.scrolls[1]-this.map.div.offsets[1]-this.map.div.lefttop[1]-this.size.h/2+"px",this.update()},changelayer:function(a){for(var b=0,c=this.mmap.layers.length;c>b;b++)this.mmap.removeLayer(this.mmap.layers[b]);this.mmap.addLayer(a.layer.clone())},update:function(){var a=new OpenLayers.Pixel(this.div.offsetLeft+this.div.offsetWidth/2,this.div.offsetTop+this.div.offsetHeight/2);this.mmap.updateSize(),this.mmap.moveTo(this.map.getLonLatFromPixel(a),this.map.getZoom()+this.delta)},destroy:function(){this.map.events&&this.map.events.un({move:this.update,changebaselayer:this.changelayer,scope:this}),this.mmap&&this.mmap.destroy(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"Zondy.Control.Magnifier"}),Zondy.Marker.Text=OpenLayers.Class(OpenLayers.Marker,{lonLat:null,content:"",size:null,div:null,tolerance:7,initialize:function(a,b,c,d,e){this.lonLat=a,this.content=b,this.size=c,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.div.style.backgroundColor="#EDEDED",this.div.style.textAlign="center",this.div.style.fontSize="12",this.div.className="ZondyMarkerTextDiv",this.events=new OpenLayers.Events(this,this.div,null),this.setBorder(d,e)},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){a||(a="#949494"),b||(b=1),this.div.style.border=b+"px solid "+a},draw:function(a){return a=a.add(this.tolerance,0),this.size||(this.size=new OpenLayers.Size(80,20)),OpenLayers.Util.modifyDOMElement(this.div,null,a,this.size),this.div.innerHTML=this.content,this.div},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"Zondy.Marker.Text"}),Zondy.Texts=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(a){var d,b=a.lonLat,c=this.map.getLayerPxFromLonLat(b);null==c?a.display(!1):(d=a.draw(c),a.drawn||(this.div.appendChild(d),a.drawn=!0))},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a),null!=a.div&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},CLASS_NAME:"Zondy.Texts"}),Zondy.Control.Measure=OpenLayers.Class(OpenLayers.Control,{handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:100,delayedTrigger:null,persist:!0,texts:null,closeMarkers:null,tolerance:15,stat:null,order:null,measureLayer:null,immediate:!0,initialize:function(a,b){var c,d,e;OpenLayers.Control.prototype.initialize.apply(this,[b]),c={done:this.measureComplete,point:this.measurePartial},this.immediate&&(c.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.clicked=!1,this.measureStyles=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:"${type}",fillColor:"#CAFF70",fillOpacity:.3,strokeColor:"#ff9933",strokeWidth:2,graphicZIndex:1})}),d={Point:{pointRadius:4,graphicName:"square",fillColor:"#556B2F",fillOpacity:.5,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#8B814C",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3,strokeDashstyle:"dash"}},this.style=new OpenLayers.Style,this.style.addRules([new OpenLayers.Rule({symbolizer:d})]),e=new OpenLayers.StyleMap({"default":this.style}),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist,layerOptions:{styleMap:e}},this.handlerOptions),this.handler=new a(this,this.callbacks,this.handlerOptions)},draw:function(){var b;return OpenLayers.Control.prototype.draw.apply(this,arguments),this.div.style.border="solid red 1px",this.div.style.backgroundColor="#E2ECFA",this.div.style.fontSize="12",this.clicked&&(this.handler.CLASS_NAME.indexOf("Path")>-1?(this.div.innerHTML="",b=document.createElement("div"),this.changeUnits(),b.innerHTML="总长: <b><font color='red'>"+this.stat[0].toFixed(2)+"</font></b>"+this.stat[1]+"<br>单击确定地点，双击结束",this.div.appendChild(b)):(this.div.innerHTML="",b=document.createElement("div"),this.changeUnits(),b.innerHTML="当前面积: <b><font color='red'>"+this.stat[0].toFixed(2)+"</font></b>平方"+this.stat[1]+"<br>单击确定地点，双击结束",this.div.appendChild(b))),this.clicked||(this.div.appendChild(document.createTextNode("")),this.map.events.register("mouseover",this,this.showDiv),this.map.events.register("mouseout",this,this.hideDiv)),this.measureLayer||(this.measureLayer=new OpenLayers.Layer.Vector("measureLayer",{styleMap:this.measureStyles}),this.map.addLayer(this.measureLayer)),this.texts||(this.texts=new Zondy.Texts("measureTexts"),this.map.addLayer(this.texts),this.pointIndex=0),this.closeMarkers||(this.closeMarkers=new OpenLayers.Layer.Markers("measureClose"),this.map.addLayer(this.closeMarkers)),this.div},showDiv:function(a){this.div.style.left=a.xy.x+this.tolerance+"px",this.div.style.top=a.xy.y+this.tolerance+"px",this.div.style.display=""},hideDiv:function(){this.div.style.display="none"},changeDivContent:function(){this.clicked=!0,this.div.innerHTML="",this.draw(),this.div.style.display=""},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(a){this.immediate=a,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},changeUnits:function(){this.stat&&("km"==this.stat[1]?this.stat[1]="千米":"m"==this.stat[1]&&(this.stat[1]="米"))},updateHandler:function(a,b){var c=this.active;c&&this.deactivate(),this.handler=new a(this,this.callbacks,b),c&&this.activate()},measureComplete:function(a){var b,c,d,e,f,g,h;this.cancelDelay(),this.measure(a),b=a.components,this.changeUnits(),c=new OpenLayers.Feature.Vector(a),this.measureLayer.addFeatures([c]),a.CLASS_NAME.indexOf("LineString")>-1?(this.lonLat=new OpenLayers.LonLat(b[this.pointIndex-1].x,b[this.pointIndex-1].y),d="总长: <b><font color='red'>"+this.stat[0].toFixed(2)+"</font></b>"+this.stat[1],e=new Zondy.Marker.Text(this.lonLat,d,new OpenLayers.Size(150,20)),this.texts.addMarker(e)):(f=b[0].components,this.lonLat=new OpenLayers.LonLat(f[this.pointIndex-1].x,f[this.pointIndex-1].y),d="总面积: <b><font color='red'>"+this.stat[0].toFixed(2)+"</font></b>平方"+this.stat[1],e=new Zondy.Marker.Text(this.lonLat,d,new OpenLayers.Size(200,20)),this.texts.addMarker(e)),g=OpenLayers.Util.getImagesLocation(),h=new OpenLayers.Marker(this.lonLat,new OpenLayers.Icon(g+"measureclose.gif",new OpenLayers.Size(15,15))),h.events.register("click",this,function(){this.measureLayer.removeFeatures([c]),this.closeMarkers.clearMarkers(),this.texts.clearMarkers(),this.map.removeLayer(this.measureLayer),this.map.removeLayer(this.closeMarkers),this.map.removeLayer(this.texts)}),h.events.register("mouseover",this,function(){h.icon.imageDiv.style.cursor="pointer",h.icon.imageDiv.title="清除本次测量"}),this.closeMarkers.addMarker(h),this.map.events.unregister("mouseover",this,this.showDiv),this.map.events.unregister("mouseout",this,this.hideDiv),this.div.innerHTML="",this.hideDiv(),this.deactivate()},measurePartial:function(a,b){var c,d,e,f;this.cancelDelay(),b=b.clone(),this.handler.freehandMode(this.handler.evt)?(this.measure(b),b.CLASS_NAME.indexOf("LineString")>-1?(c=b.components,this.changeUnits(),0==this.pointIndex?(d=new OpenLayers.LonLat(c[0].x,c[0].y),e=new Zondy.Marker.Text(d,"<b><font color='#5E5E5E'>起点",new OpenLayers.Size(50,20)),this.texts.addMarker(e),this.pointIndex++):(d=new OpenLayers.LonLat(c[this.pointIndex].x,c[this.pointIndex].y),f="<b><font color='red'>"+this.stat[0].toFixed(2)+"</font></b>"+this.stat[1],e=new Zondy.Marker.Text(d,f,new OpenLayers.Size(80,20)),this.texts.addMarker(e),this.pointIndex++)):this.pointIndex++):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){var a,c,d,e;this.delayedTrigger=null,this.measure(b),a=b.components,this.changeUnits(),b.CLASS_NAME.indexOf("LineString")>-1?0==this.pointIndex?(c=new OpenLayers.LonLat(a[0].x,a[0].y),d=new Zondy.Marker.Text(c,"<b><font color='#5E5E5E'>起点",new OpenLayers.Size(50,20)),this.texts.addMarker(d),this.pointIndex++):(c=new OpenLayers.LonLat(a[this.pointIndex].x,a[this.pointIndex].y),e="<b><font color='red'>"+this.stat[0].toFixed(2)+"</font></b><font color='#5E5E5E'>"+this.stat[1]+"</font>",d=new Zondy.Marker.Text(c,e,new OpenLayers.Size(80,20)),this.texts.addMarker(d),this.pointIndex++):this.pointIndex++},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&null===this.delayedTrigger&&!this.handler.freehandMode(this.handler.evt)&&(this.measure(b.geometry),this.changeDivContent())},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a){a.CLASS_NAME.indexOf("LineString")>-1?(this.stat=this.getBestLength(a),this.order=1):(this.stat=this.getBestArea(a),this.order=2)},getBestArea:function(a){var c,d,e,f,b=this.displaySystemUnits[this.displaySystem];for(e=0,f=b.length;f>e&&(c=b[e],d=this.getArea(a,c),!(d>1));++e);return[d,c]},getArea:function(a,b){var c,d,e,f;return this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits()),e=OpenLayers.INCHES_PER_UNIT[b],e&&(f=OpenLayers.INCHES_PER_UNIT[d],c*=Math.pow(f/e,2)),c},getBestLength:function(a){var c,d,e,f,b=this.displaySystemUnits[this.displaySystem];for(e=0,f=b.length;f>e&&(c=b[e],d=this.getLength(a,c),!(d>1));++e);return[d,c]},getLength:function(a,b){var c,d,e,f;return this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits()),e=OpenLayers.INCHES_PER_UNIT[b],e&&(f=OpenLayers.INCHES_PER_UNIT[d],c*=f/e),c},CLASS_NAME:"Zondy.Control.Measure"}),OpenLayers.Events.prototype.BROWSER_EVENTS=["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","resize","focus","blur","contextmenu"],Zondy.Control.RightClickMenu=OpenLayers.Class(OpenLayers.Control,{element:null,zoomBox:null,boxes:null,pointIndex:0,dragPan:null,measureResult:"",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.element=document.createElement("div"),this.element.style.backgroundColor="#E2ECFA"},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.div.oncontextmenu=function(){return!1},this.div.style.border="solid blue 1px",this.noContextMenu(),this.map.events.register("contextmenu",this,this.showDiv),this.map.events.register("click",this,this.hideDiv),this.activate(),this.div},noContextMenu:function(){function c(a){b.doFunction(a)}var f,g,h,i,a=OpenLayers.Util.getImagesLocation(),b=this,d=["放大","缩小","移动","复位","刷新","鹰眼","放大镜","测距","测面积"],e=document.createElement("table");for(e.border="0px",i=0;i<d.length;i++)f=e.insertRow(i),f.onmouseover=function(){this.style.cursor="hand",this.style.backgroundColor="#3370CC"},f.onmouseout=function(){this.style.cursor="default",this.style.backgroundColor="transparent"},f.onclick=function(){c(this.rowIndex)},g=f.insertCell(0),g.style.width="30%",g.style.backgroundColor="#00CCFF",g.appendChild(OpenLayers.Util.createImage(null,null,OpenLayers.Size(10,10),a+"rmenu"+(i+1)+".gif",null,null,null,null)),h=f.insertCell(1),h.style.width="70%",h.style.fontSize="12",h.appendChild(document.createTextNode(d[i]));this.element.appendChild(e),this.div.appendChild(this.element),this.hideDiv()},doFunction:function(a){switch(a){case 0:this.zoomIn(),this.hideDiv();break;case 1:this.zoomOut(),this.hideDiv();break;case 2:this.move(),this.hideDiv();break;case 3:this.reset(),this.hideDiv();break;case 4:this.refresh(),this.hideDiv();break;case 5:this.overviewMap(),this.hideDiv();break;case 6:this.magnifier(),this.hideDiv();break;case 7:this.measureDistance(),this.hideDiv();break;case 8:this.measureArea(),this.hideDiv()}},showDiv:function(a){this.div.style.left=a.xy.x+"px",this.div.style.top=a.xy.y+"px",this.div.style.display=""},hideDiv:function(){this.div.style.display="none"},zoomIn:function(){this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map}),this.zoomBox.draw(),this.zoomBox.activate()},zoomOut:function(){this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,out:!0}),this.zoomBox.draw(),this.zoomBox.activate()},move:function(){this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map},null)),this.dragPan.draw(),this.dragPan.activate()},reset:function(){this.map.zoomToMaxExtent()},refresh:function(){this.map.baseLayer.clearGrid(),this.map.baseLayer.redraw()},overviewMap:function(){var a=new Zondy.Control.OverviewMap;this.map.addControl(a),a.activate(),a.maximizeControl()},magnifier:function(){var a=new Zondy.Control.Magnifier({maxExtent:new OpenLayers.Bounds(114.125602,30.453932,114.500707,30.829037),maxResolution:.00146525390625});this.map.addControl(a)},measureDistance:function(){this.measure=new Zondy.Control.Measure(OpenLayers.Handler.Path),this.map.addControl(this.measure),this.measure.activate()},measureArea:function(){this.measure=new Zondy.Control.Measure(OpenLayers.Handler.Polygon),this.map.addControl(this.measure),this.measure.activate()},destroy:function(){this.div.innerHTML="",OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"Zondy.Control.RightClickMenu"}),Zondy.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(140,130),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,initialize:function(a){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.eventsDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(OpenLayers.Event.stopObservingElement(this.maximizeDiv),this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(OpenLayers.Event.stopObservingElement(this.minimizeDiv),this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))
},draw:function(){var a,b,c,d,e,f;if(OpenLayers.Control.prototype.draw.apply(this,arguments),!(this.layers.length>0)){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;a=this.map.baseLayer.clone(),this.layers=[a]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{for(this.div.className+=" "+this.displayClass+"Container",b=OpenLayers.Util.getImagesLocation(),c=b+"h_arrow.gif",this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(15,15),c,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton",OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this)),this.div.appendChild(this.maximizeDiv),c=b+"d_arrow.gif",this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(15,15),c,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton",OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this)),this.div.appendChild(this.minimizeDiv),d=["dblclick","mousedown"],e=0,f=d.length;f>e;e++)OpenLayers.Event.observe(this.maximizeDiv,d[e],OpenLayers.Event.stop),OpenLayers.Event.observe(this.minimizeDiv,d[e],OpenLayers.Event.stop);this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.register("moveend",this,this.update),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var d,e,f,g,h,i,b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;(0!=b||0!=c)&&(d=this.rectPxBounds.top,e=this.rectPxBounds.left,f=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),h=Math.max(0,d-c),h=Math.min(h,this.ovmap.size.h-this.hComp-f),i=Math.max(0,e-b),i=Math.min(i,this.ovmap.size.w-this.wComp-g),this.setRectPxBounds(new OpenLayers.Bounds(i,h+f,i+g,h)))},mapDivClick:function(a){var j,b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left,g=Math.abs(this.rectPxBounds.getHeight()),h=this.rectPxBounds.getWidth(),i=Math.max(0,e+d);i=Math.min(i,this.ovmap.size.h-g),j=Math.max(0,f+c),j=Math.min(j,this.ovmap.size.w-h),this.setRectPxBounds(new OpenLayers.Bounds(j,i+g,j+h,i)),this.updateMapToRect()},maximizeControl:function(a){function d(){parseInt(b.element.style.height)<b.size.h&&parseInt(b.element.style.width)<b.size.w?(b.element.style.width=parseInt(b.element.style.width)+b.size.w/10+"px",b.element.style.height=parseInt(b.element.style.height)+b.size.h/10+"px",c=setTimeout(d,20)):(b.showToggle(!1),clearTimeout(c))}var c,b=this;this.element.style.display="",this.element.style.height="0px",this.element.style.width="0px",d(),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){function d(){parseInt(b.element.style.height)>0&&parseInt(b.element.style.width)>0?(b.element.style.width=parseInt(b.element.style.width)-b.size.w/10+"px",b.element.style.height=parseInt(b.element.style.height)-b.size.h/10+"px",c=setTimeout(d,20)):(b.element.style.display="none",b.showToggle(!0),clearTimeout(c))}var c,b=this;d(),null!=a&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none",this.minimizeDiv.style.display=a?"none":""},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var d,a=this.map.getExtent(),b=this.map.maxExtent,c=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));return this.ovmap.getProjection()!=this.map.getProjection()&&(c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())),d=this.ovmap.getResolution()/this.map.getResolution(),d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var d,a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a),this.ovmap.getProjection()!=this.map.getProjection()?(d=this.map.center.clone(),d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):d=this.map.center,this.ovmap.setCenter(d,this.ovmap.getZoomForResolution(b*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var b,c,a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a),this.ovmap.eventsDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()&&(b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units,this.resolutionFactor=b&&c?OpenLayers.INCHES_PER_UNIT[b]/OpenLayers.INCHES_PER_UNIT[c]:1)},updateRectToMap:function(){var a,b;a=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent(),b=this.getRectBoundsFromMapBounds(a),b&&this.setRectPxBounds(b)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var h,i,b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp),e=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp),f=Math.max(e-c,0),g=Math.max(d-b,0);f<this.minRectSize||g<this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,h=c+f/2-this.minRectSize/2,i=b+g/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(i)+"px",this.extentRectangle.style.left=Math.round(h)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(g)+"px",this.extentRectangle.style.width=Math.round(f)+"px"),this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(e),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=new OpenLayers.LonLat(a.left,a.bottom),c=new OpenLayers.LonLat(a.right,a.top),d=this.getOverviewPxFromLonLat(b),e=this.getOverviewPxFromLonLat(c),f=null;return d&&e&&(f=new OpenLayers.Bounds(d.x,d.y,e.x,e.y)),f},getMapBoundsFromRectBounds:function(a){var b=new OpenLayers.Pixel(a.left,a.bottom),c=new OpenLayers.Pixel(a.right,a.top),d=this.getLonLatFromOverviewPx(b),e=this.getLonLatFromOverviewPx(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat(),e=a.x-b.w/2,f=a.y-b.h/2;return new OpenLayers.LonLat(d.lon+e*c,d.lat-f*c)},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent(),d=null;return c&&(d=new OpenLayers.Pixel(Math.round(1/b*(a.lon-c.left)),Math.round(1/b*(c.top-a.lat)))),d},CLASS_NAME:"Zondy.Control.OverviewMap"}),Zondy.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layerSwitcherSize:new OpenLayers.Size(180,200),layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,layerBtnDiv:null,ascending:!0,initialize:function(a){this.layerStates=[],OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Event.stopObservingElement(this.div),OpenLayers.Event.stopObservingElement(this.layerBtnDiv),this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.showControls(!1),this.redraw(),this.div},clearLayersArray:function(a){var c,d,e,b=this[a+"Layers"];if(b)for(c=0,d=b.length;d>c;c++)e=b[c],OpenLayers.Event.stopObservingElement(e.inputElem),OpenLayers.Event.stopObservingElement(e.labelSpan);this[a+"LayersDiv"].innerHTML="",this[a+"Layers"]=[]},checkRedraw:function(){var b,c,d,e,a=!1;if(this.layerStates.length&&this.map.layers.length==this.layerStates.length){for(b=0,c=this.layerStates.length;c>b;b++)if(d=this.layerStates[b],e=this.map.layers[b],d.name!=e.name||d.inRange!=e.inRange||d.id!=e.id||d.visibility!=e.visibility){a=!0;break}}else a=!0;return a},redraw:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if(!this.checkRedraw())return this.div;for(this.clearLayersArray("base"),this.clearLayersArray("data"),a=!1,b=!1,c=this.map.layers.length,this.layerStates=new Array(c),d=0;c>d;d++)e=this.map.layers[d],this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id};for(f=this.map.layers.slice(),this.ascending||f.reverse(),d=0,c=f.length;c>d;d++)e=f[d],g=e.isBaseLayer,e.displayInLayerSwitcher&&(g?b=!0:a=!0,h=g?e==this.map.baseLayer:e.getVisibility(),i=document.createElement("input"),i.id=this.id+"_input_"+e.name,i.name=g?this.id+"_baseLayers":e.name,i.type=g?"radio":"checkbox",i.value=e.name,i.checked=h,i.defaultChecked=h,g||e.inRange||(i.disabled=!0),j={inputElem:i,layer:e,layerSwitcher:this},OpenLayers.Event.observe(i,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,j)),k=document.createElement("span"),OpenLayers.Element.addClass(k,"labelSpan"),g||e.inRange||(k.style.color="gray"),k.innerHTML=e.name,k.style.verticalAlign=g?"bottom":"baseline",OpenLayers.Event.observe(k,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,j)),l=document.createElement("br"),m=g?this.baseLayers:this.dataLayers,m.push({layer:e,inputElem:i,labelSpan:k}),n=g?this.baseLayersDiv:this.dataLayersDiv,n.appendChild(i),n.appendChild(k),n.appendChild(l));return this.dataLbl.style.display=a?"":"none",this.baseLbl.style.display=b?"":"none",this.div},onInputClick:function(a){this.inputElem.disabled||("radio"==this.inputElem.type?(this.inputElem.checked=!0,this.layer.map.setBaseLayer(this.layer)):(this.inputElem.checked=!this.inputElem.checked,this.layerSwitcher.updateMap())),OpenLayers.Event.stop(a)},onLayerClick:function(){this.updateMap()},updateMap:function(){var a,b,c;for(a=0,b=this.baseLayers.length;b>a;a++)c=this.baseLayers[a],c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1);for(a=0,b=this.dataLayers.length;b>a;a++)c=this.dataLayers[a],c.layer.setVisibility(c.inputElem.checked)},maxOrminControl:function(a){function d(){parseInt(b.div.style.height)<b.layerSwitcherSize.h?(b.div.style.height=parseInt(b.div.style.height)+20+"px",c=setTimeout(d,1)):clearTimeout(c)}function e(){parseInt(b.div.style.height)>20?(b.div.style.height=parseInt(b.div.style.height)-20+"px",c=setTimeout(e,1)):clearTimeout(c)}var c,b=this;this.layersDiv.style.display="","展开"==this.layerBtnSpan.innerText?(this.layerBtnSpan.innerText="收缩",d()):(this.layerBtnSpan.innerText="展开",e()),null!=a&&OpenLayers.Event.stop(a)},mouseoverlayerBtnSpan:function(a){this.layerBtnSpan.style.color="#A52A2A",null!=a&&OpenLayers.Event.stop(a)},mouseoutlayerBtnSpan:function(a){this.layerBtnSpan.style.color="black",null!=a&&OpenLayers.Event.stop(a)},showControls:function(a){this.layersDiv.style.display=a?"":"none"},loadContents:function(){OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this)),OpenLayers.Event.observe(this.div,"click",this.ignoreEvent),OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this)),OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent),this.div.style.backgroundColor="#E2ECFA",this.div.style.display="",this.div.style.width=this.layerSwitcherSize.w+"px",this.div.style.height="20px",this.div.style.border="4px #226DDD double",this.layerBtnDiv=document.createElement("div"),OpenLayers.Element.addClass(this.layerBtnDiv,"layerBtnDiv"),this.layerBtnDiv.appendChild(document.createTextNode("图层列表")),this.div.appendChild(this.layerBtnDiv),this.line=document.createElement("hr"),this.line.style.width="100%",this.line.style.position="absolute",this.line.style.top="20px",this.div.appendChild(this.line),this.layerBtnSpan=document.createElement("span"),OpenLayers.Element.addClass(this.layerBtnSpan,"layerBtnSpan"),this.layerBtnSpan.title="展开/收缩",this.layerBtnSpan.appendChild(document.createTextNode("展开")),OpenLayers.Event.observe(this.layerBtnSpan,"click",OpenLayers.Function.bindAsEventListener(this.maxOrminControl,this)),OpenLayers.Event.observe(this.layerBtnSpan,"mouseover",OpenLayers.Function.bindAsEventListener(this.mouseoverlayerBtnSpan,this)),OpenLayers.Event.observe(this.layerBtnSpan,"mouseout",OpenLayers.Function.bindAsEventListener(this.mouseoutlayerBtnSpan,this)),this.div.appendChild(this.layerBtnSpan),this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.layersDiv.style.height=this.layerSwitcherSize.h-30+"px",this.layersDiv.style.width=this.layerSwitcherSize.w+"px",this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("基础图层"),this.baseLbl.style.color="#636363",OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.style.color="#636363",this.dataLbl.innerHTML=OpenLayers.i18n("覆盖层"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv)},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=!0,this.ignoreEvent(a)},mouseUp:function(a){this.isMouseDown&&(this.isMouseDown=!1,this.ignoreEvent(a))},CLASS_NAME:"Zondy.Control.LayerSwitcher"}),OpenLayers.Popup.CSSFramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{autoSize:!0,panMapIfOutOfView:!0,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,-6),padding:new OpenLayers.Bounds(5,14,5,5),blocks:[{className:"olwidgetPopupStemTL",size:new OpenLayers.Size(20,20),anchor:new OpenLayers.Bounds(null,4,32,null),position:new OpenLayers.Pixel(0,-28)}]},tr:{offset:new OpenLayers.Pixel(-44,-6),padding:new OpenLayers.Bounds(5,14,5,5),blocks:[{className:"olwidgetPopupStemTR",size:new OpenLayers.Size(20,20),anchor:new OpenLayers.Bounds(32,4,null,null),position:new OpenLayers.Pixel(0,-28)}]},bl:{offset:new OpenLayers.Pixel(44,6),padding:new OpenLayers.Bounds(5,5,5,14),blocks:[{className:"olwidgetPopupStemBL",size:new OpenLayers.Size(20,20),anchor:new OpenLayers.Bounds(null,null,32,4),position:new OpenLayers.Pixel(0,0)}]},br:{offset:new OpenLayers.Pixel(-44,6),padding:new OpenLayers.Bounds(5,5,5,14),blocks:[{className:"olwidgetPopupStemBR",size:new OpenLayers.Size(20,20),anchor:new OpenLayers.Bounds(32,null,null,4),position:new OpenLayers.Pixel(0,0)}]}},initialize:function(a,b,c,d,e,f,g,h,i){h&&"auto"!=h&&(this.fixedRelativePosition=!0,this.relativePosition=h),this.separator=void 0===i?" of ":i,this.olwidgetCloseBox=f,this.olwidgetCloseBoxCallback=g,this.page=0,OpenLayers.Popup.Framed.prototype.initialize.apply(this,[a,b,c,d,e,!1,null])},setContentHTML:function(a){var b,c,d;null!==a&&void 0!==a&&(this.contentHTML=a),null!==this.contentDiv&&(b=this,this.contentDiv.innerHTML="",c=document.createElement("div"),c.innerHTML=this.contentHTML,c.className="olwidgetPopupContent",this.contentDiv.appendChild(c),this.olwidgetCloseBox&&(d=document.createElement("div"),d.className="olwidgetPopupCloseBox",d.innerHTML="",d.onclick=function(a){b.hide(),OpenLayers.Event.stop(a)},this.contentDiv.appendChild(d)),this.autoSize&&(this.registerImageListeners(),this.updateSize()))},createBlocks:function(){var a,b,c,d,e,f;this.blocks=[],a=null;for(b in this.positionBlocks){a=b;break}for(c=this.positionBlocks[a],d=0;d<c.blocks.length;d++)e={},this.blocks.push(e),f=this.id+"_FrameDecorationDiv_"+d,e.div=OpenLayers.Util.createDiv(f,null,null,null,"absolute",null,"hidden",null),this.groupDiv.appendChild(e.div)},updateBlocks:function(){var a,b,c,d,e,f,g,h,i,j;if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++)c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,i=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,j=isNaN(c.size.h)?this.size.h-(f+h):c.size.h,d.div.style.width=(0>i?0:i)+"px",d.div.style.height=(0>j?0:j)+"px",d.div.style.left=null!==e?e+"px":"",d.div.style.bottom=null!==f?f+"px":"",d.div.style.right=null!==g?g+"px":"",d.div.style.top=null!==h?h+"px":"",d.div.className=c.className;this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},updateSize:function(){return OpenLayers.Popup.prototype.updateSize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.CSSFramedCloud"});